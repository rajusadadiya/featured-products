<?php 
/**
 * Raju Sadadiya
 *
 * NOTICE OF LICENSE
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @category    RS
 * @package     RS_FeaturedProducts
 */
use Magento\Framework\App\Action\Action;
?>
<?php if($this->isEnable()): ?>
	<?php 
		$_productCollection = $this->getProducts();
		$_helper = $this->helper('Magento\Catalog\Helper\Output');
		$viewMode = 'grid';
		$image = 'category_page_grid';
		$showDescription = false;
		$templateType = \Magento\Catalog\Block\Product\ReviewRendererInterface::SHORT_VIEW;
	?>
	<?php $pos = $block->getPositioned(); ?>
	<div class="rs-product-block">		
		<div class="heading rs-featured-heading"><h2><?php echo $this->getTitle(); ?></h2></div>
		<?php if($_productCollection->count() > 0): ?>
			<div class="products-grid">
				<ol class="<?php echo $this->isSliderEnable() && $_productCollection->count() > $this->getDefaultSliderItem() ? "owl-carousel" :""; ?> products list items product-items rs-fp-product">
					<?php $_collectionSize = $_productCollection->count() ?>
					<?php $i=0; ?>
					<?php foreach ($_productCollection as $_product): ?>	
					<li class='item product product-item'>
						<div class="product-item-info">
								<?php
								$newFromDate = $_product->getNewsFromDate();
								$newToDate = $_product->getNewsToDate();                 
								$now = date("Y-m-d H:m(worry)");
								// Get the Special Price
								$specialprice = $_product->getSpecialPrice(); 
								// Get the Special Price FROM date
								$specialPriceFromDate = $_product->getSpecialFromDate();
								// Get the Special Price TO date
								$specialPriceToDate = $_product->getSpecialToDate();
								// Get Current date
								if ($specialprice && ($specialPriceFromDate <= $now && $specialPriceToDate >= $now))
								{
									echo "<span class='icon-sale icon-product'>Sale</span>";
								}
								else{
									if($newFromDate <= $now && $newToDate >= $now) {
										echo "<span class='icon-new icon-product'>Hot</span>";
										//echo $now.' -- '.$newsFrom.' -- '.$newsTo;
									}
								}
								?>
								<?php
								$productImage = $block->getImage($_product, $image);
								if($this->isSliderEnable() && $_productCollection->count() > $this->getDefaultSliderItem())
								{
									$imageDimentions = $this->getImageHightWidth();
									$productImage->setWidth($imageDimentions['width']);
									$productImage->setHeight($imageDimentions['height']);							
								}
								if ($pos != null) {
									$position = ' style="left:' . $productImage->getWidth() . 'px;'
										. 'top:' . $productImage->getHeight() . 'px;"';
								}
								?>
								<?php // Product Image ?>
								<a href="<?php /* @escapeNotVerified */ echo $_product->getProductUrl() ?>" class="product photo product-item-photo" tabindex="-1">
									<?php echo $productImage->toHtml(); ?>
								</a>
								<?php
									$_productNameStripped = $block->stripTags($_product->getName(), null, true);
								?>

						<div class="product details product-item-details">
							<strong class="product name product-item-name">
								<a class="product-item-link"
									   href="<?php /* @escapeNotVerified */ echo $_product->getProductUrl() ?>">
										<?php /* @escapeNotVerified */ echo $_helper->productAttribute($_product, $_product->getName(), 'name'); ?>
									</a>
							</strong>
								<?php if($this->isShowReview()): ?>
									<div class="product-ratting">
										<?php echo $block->getReviewsSummaryHtml($_product, $templateType); ?>
									</div>
								<?php endif; ?>
							<?php if($this->isShowPrice()): ?>
								<?php /* @escapeNotVerified */ echo $block->getProductPrice($_product) ?>
	            				<?php echo $block->getProductDetailsHtml($_product); ?>
							<?php endif; ?>							
							<div class="product-item-inner">
								<div class="product actions product-item-actions">
	            					<?php if($this->isShowAddToCart()): ?>
	            					<div class="actions-primary">
										<?php if ($_product->isSaleable()): ?>
											<?php $postParams = $block->getAddToCartPostParams($_product); ?>
										<form data-role="tocart-form" action="<?php /* @escapeNotVerified */ echo $postParams['action']; ?>" method="post">
												<input type="hidden" name="product" value="<?php /* @escapeNotVerified */ echo $postParams['data']['product']; ?>">
												<input type="hidden" name="<?php /* @escapeNotVerified */ echo Action::PARAM_NAME_URL_ENCODED; ?>" value="<?php /* @escapeNotVerified */ echo $postParams['data'][Action::PARAM_NAME_URL_ENCODED]; ?>">
												<?php echo $block->getBlockHtml('formkey')?>
												<button type="submit"
														title="<?php echo $block->escapeHtml(__('Add to Cart')); ?>"
														class="action tocart primary">
													<span><?php /* @escapeNotVerified */ echo __('Add to Cart') ?></span>
												</button>
										</form>
										<?php else: ?>
											<?php if ($_product->getIsSalable()): ?>
													<div class="stock available"><span><?php /* @escapeNotVerified */ echo __('In stock') ?></span></div>
											<?php else: ?>
													<div class="stock unavailable"><span><?php /* @escapeNotVerified */ echo __('Out of stock') ?></span></div>
											<?php endif; ?>
										<?php endif; ?>
									</div>
	            					<?php endif; ?>		
									<div class="actions-secondary" data-role="add-to-links">
										<?php if($this->isShowAddToWishlist()): ?>
										<?php if ($this->helper('Magento\Wishlist\Helper\Data')->isAllow()): ?>
										<a href="#" class="action towishlist" title="<?php echo $block->escapeHtml(__('Add to Wish List')); ?>" aria-label="<?php echo $block->escapeHtml(__('Add to Wish List')); ?>" data-post='<?php /* @escapeNotVerified */ echo $block->getAddToWishlistParams($_product); ?>' data-action="add-to-wishlist" role="button"><span><?php /* @escapeNotVerified */ echo __('Add to Wish List') ?></span></a>
										<?php endif; ?>
										<?php endif; ?>
										<?php if($this->isShowAddToCompare()): ?>
										<?php $compareHelper = $this->helper('Magento\Catalog\Helper\Product\Compare'); ?>
										<a href="#" class="action tocompare" title="<?php echo $block->escapeHtml(__('Add to Compare')); ?>" aria-label="<?php echo $block->escapeHtml(__('Add to Compare')); ?>" data-post='<?php /* @escapeNotVerified */ echo $compareHelper->getPostDataParams($_product); ?>' role="button">
											<span><?php /* @escapeNotVerified */ echo __('Add to Compare') ?></span>
										</a>
										<?php endif; ?>
									</div>
								</div>
							</div>
							<?php $i++;?>
						</div>
					</div>
					</li>
					<?php endforeach; ?>
				</ol>
			</div>
			<?php else : ?>
			<div class="error">	
				<p class="note-msg"><?php echo __('There are no products matching the selection.') ?></p>
			</div>
		<?php endif; ?>
		<?php if (!$block->isRedirectToCartEnabled()) : ?>
			<script type="text/x-magento-init">
			{
				"[data-role=tocart-form], .form.map.checkout": {
					"catalogAddToCart": {}
				}
			}
			</script>
		<?php endif; ?>
			<script>
				<?php if($this->isSliderEnable() && $_productCollection->count() > $this->getDefaultSliderItem()): ?>
				require([
					'jquery',
					'mage/mage',
					'rsowl'
				], function ($) {
					'use strict';
					jQuery(".owl-carousel").owlCarousel({
						autoplay : <?php echo $this->enableAutoSlide() ; ?>,
						items : <?php echo $this->getDefaultSliderItem(); ?>,
						autoplayTimeout : <?php echo $this->getSliderSpeed(); ?>,
						nav : <?php echo $this->isShowNextPrev(); ?>,
						dots : <?php echo $this->isShowNavigation(); ?>,
						loop:true,
						autoplayHoverPause:true,
					});
				});
			<?php endif;?>
			</script>
	</div>
<?php endif; ?>
<style type="text/css">
	.rs-product-block .product-item-info{
		width: auto !important;
	}
	.rs-product-block .product-item-info .product-item-inner{ margin-top: 8px; }
	<?php if($this->isSliderEnable() && $_productCollection->count() > $this->getDefaultSliderItem()): ?>
	.rs-product-block .owl-nav
	{
		position: absolute;
		top: 35%;
        left: 2;
        right: 2;
        width:100%;
	}
    .rs-product-block .owl-nav .owl-prev, .rs-product-block .owl-nav .owl-next 
    {
        position: absolute;
        height: 50px;
        border: none;
        z-index: 100;
        width: 50px;
        box-shadow: 0px 0px 0px transparent !important;
        border-radius: 90px;
        line-height: 40px !important;
        background-color: #666 !important;
    }

    .rs-product-block .owl-nav .owl-prev {
        left: 0;
    }

    .rs-product-block .owl-nav .owl-next {
        right: 0;
    }
    .rs-product-block .owl-nav .owl-prev span, .rs-product-block .owl-nav .owl-next span{
    	color: #fff;
    	font-size: 3.5rem;
        font-weight: bolder;
    }
    .rs-product-block .owl-nav .owl-prev:hover, .rs-product-block .owl-nav .owl-next:hover{
    	background-color: #006bb4 !important;
    }

    .rs-product-block .owl-dots{
    	margin: 2px auto;
    	text-align: center;
    }
    .rs-product-block .owl-dots .owl-dot{
    	box-shadow: 0px 0px 0px transparent !important;
    	border:1px solid #006bb4 !important;
    	height: 10px;
    	width:10px;
    	border-radius:90px;
    	margin:0px 3px;
    }
    .rs-product-block .owl-dots .owl-dot.active{
    	background-color: #006bb4 !important;
    }

	.rs-product-block .product-item{
		width: auto !important;
		padding-left :0px !important;
	}
	.rs-product-block .product-item-info{
		width: auto;
		max-width: initial;
		padding: 9px !important;
		border:1px solid transparent !important;
	}
	.rs-product-block .product-item-info:hover
	{
		margin:0px;
		border:1px solid #bbb !important;
	}
	.column.main .product-items{
		margin-left: 0px;
	}
	.rs-product-block .product-item-inner
	{
		position: relative !important;
		border:none;
		box-shadow: none;
		display: block !important;
		overflow: inherit !important;
		height: auto !important;
		padding: 0px 9px 9px 9px;
	}
	.products-grid .product-item-info:not(:hover):not(.active) .product-item-inner
	{
		padding: 0px 9px 9px 9px !important;
		width: auto !important;
	}
	.rs-product-block .product-item-actions{
		display: block !important;	
	}
<?php endif;?>
</style>